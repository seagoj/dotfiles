#!/usr/bin/zsh
echo "Requires packages:\nmingw-gcc-g++\nmingw-zlib-devel\npkg-config\nautoconf\nautomake\ngit\nwget\n==================\n\n"

# Build PCRE
wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.32.tar.gz
tar xzf pcre-8.32.tar.gz
cd pcre-8.32
./configure CC=i686-pc-mingw64-gcc CXX=i686-pc-mingw64-g++ --enable-jit --enable-unicode-properties --disable-shared
make && cd ..

# Build AG
git clone https://github.com/ggreer/the_silver_searcher.git
cd the_silver_searcher/
aclocal && autoconf && autoheader && automake --add-missing
#aclocal && autoconf && autoheader && automake
./configure CC=i686-pc-mingw64-gcc PCRE_CFLAGS='-I../pcre-8.32' PCRE_LIBS='-L../pcre-8.32/.libs -static -lpcre' LIBS='-lshlwapi'
make CFLAGS='-g -O2 -I../pcre-8.32 -Wall -Wextra -DPCRE_STATIC'
strip ag
