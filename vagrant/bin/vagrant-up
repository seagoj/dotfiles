#!/bin/bash

OUTPUT='&> /dev/null'
DESTROY=0

while [[ $# > 0 ]]; do
	case $1 in
	--debug)
		OUTPUT=""
		shift
		;;
	--destroy | --rebuild)
		DESTROY=1
		shift
		;;
	*)
		shift
		;;
	esac
done

if [[ 1 == $DESTROY ]]; then
	eval "vagrant destroy -f ${OUTPUT}"
fi

(\
	(eval "vagrant resume ${OUTPUT}"; vagrant ssh) || \
	(ssh-keygen -R \[127.0.0.1\]:2222 && vagrant destroy -f && vagrant up && ssh-copy-id vagrant@127.0.0.1 -p 2222; vagrant ssh) \
) && vagrant suspend
